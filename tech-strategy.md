# 技術選定の背景と狙い

##  想定プロダクト・フェーズ

本構成は、Unity製のソーシャルゲームを0→1で立ち上げるフェーズにおいて、**初期MVPリリースから安定運用までを3～6ヶ月で実現すること**を目標としたBFF/API基盤の技術設計です。

- プレイヤー数は初期 1万～10万DAU を想定
- ログイン／ガチャ／クエストなどの基本APIを提供
- 運用中のイベント追加・DBマイグレーション・ログ解析対応も必要

##  技術選定ポリシー

1. **初期開発スピードと学習コストの低さ**
2. **人材確保のしやすさと属人化の回避**
3. **本番運用やスケーラビリティを見据えた構成**
4. **CI/CD・インフラ自動化との親和性**

##  採用技術と理由

### Laravel（BFF / API）

- PHPの中でも開発効率が高く、学習コストが低い
- フレームワークとしての成熟度が高く、イベント/ガチャ/ログなど**ゲーム特有の機能**を実装しやすい
- **業界内にLaravel経験者が多く、人材調達がしやすい**
- Artisan CLIによるコマンド管理・マイグレーション支援が便利

### MySQL（RDB）

- 読み取りが高速で、キャッシュとの併用がしやすい
- Laravelと親和性が高く、Eloquent ORMとの相性も良い
- ゲーム運用における「参照頻度高、書き込み頻度中」な特性にマッチ

### ローカル開発環境（Docker）

- チーム内での環境差異を排除し、開発効率を最大化するために Docker + docker-compose による開発環境のコンテナ化を採用
- app（PHP）・web（Nginx）・db（MySQL）・phpmyadmin の4サービスで構成
- Laravel プロジェクトの src/ 以下をマウントし、ホットリロード開発や Artisan / Composer の実行も容易に

### Jenkins + Shell（CI/CD）

- レガシー環境との互換性や、自由度の高いビルド／デプロイ制御が可能
- ShellスクリプトやTerraformと連携し、**EC2ベースのデプロイ環境にも柔軟に対応**
- `.env`管理やDBマイグレーションなどの一連の手順を**Jenkinsfileにより自動化**
- Slack通知やGitHub連携による**チーム内の可視化・属人化排除**を支援

### AWS EC2（インフラ戦略）

- インスタンスタイプの柔軟な選択や リザーブド/スポットの活用により、長期運用時のコスト最適化が可能
- AutoScaling Group + ALB構成により、アクセス集中時もスケーラブルな運用が可能
- 管理CMSはセキュリティと負荷分離の観点から APIサーバとは別のEC2で運用予定
- Terraform による初期構築コード化を前提とし、インフラ再現性・保守性を重視した運用設計

### Unity との連携

- `UnityWebRequest` によるBFF呼び出しを前提としたAPI構成
- **APIバージョニング** や **トークン認証（JWT）** を想定
- クライアントバージョンとの整合性チェックも設計対象に含む

### マスターデータ管理戦略

- マスターデータは **GitHub上でCSV形式でバージョン管理**され、PRベースでの運用を想定。
- 差分比較が容易で、過去バージョンへのロールバックも可能。
- 簡易的なマスターデータCMSとの連携により、**非エンジニアによる入力・更新も可能**な構成を視野に入れる。
- 本番反映時には Jenkins 経由でS3への自動適用も設計可能。

### In-App Purchase（課金機能）

- MVPフェーズにおいても、**有償ガチャ・アイテム販売を通じたマネタイズ**を早期に計測するため、課金処理を含む。
- 課金検証は **Apple / Google のサーバーサイドレシート検証API** を活用し、不正防止と再送処理にも対応。
- Laravel側では、課金検証結果をもとに**取引ログを永続化し、課金通貨の発行・アイテム付与などをトランザクション管理**で安全に処理。
- ユーザーごとの課金履歴・利用履歴はKPI集計・運営判断に活用予定。
- 将来的には返金対応・不正監視・キャンペーン連携などの強化も視野に入れる。


### アセット配信方針

本プロジェクトでは、将来的な運用コスト削減と初期DLサイズの抑制を目的として、Unity Addressables によるアセットバンドル化と Amazon S3 経由の配信を設計上は想定している。
ただし、初期MVPフェーズ（3ヶ月以内）では以下の理由から **アセットバンドル化は見送り**：
- 実装および検証コストが高く、機能完成を遅らせるリスクがある
- そもそも初期配信アセット量が少なく、ストレージ圧迫の懸念が小さい
- 動的DLよりも「まず遊べること」重視のフェーズである

今後のバージョンアップ時に **アセットバンドルによる配信最適化を順次導入予定**。

### 管理CMS構成方針

- **MVPフェーズ**においては、`Laravel Nova` を活用して高速かつ低コストでCMSを構築。
  - 管理画面からのマスターデータ編集、ユーザー管理、クエスト管理などを迅速に実現。
  - 権限管理・認証機能も初期から含まれており、**セキュアな運用**が可能。

- **本番運用フェーズ以降**は、`Laravel Blade + カスタムUI` に段階的に移行し、以下を実現：
  - 運用オペレーターの業務フローに最適化された **UI/UX の提供**
  - ガチャ設定や報酬配布など、**ゲーム固有の業務ロジックへの柔軟な対応**

- CMSは **APIサーバーとは別のEC2インスタンス** にデプロイし、セキュリティ確保と負荷分散の両立を図る構成とする。


### KPI出力戦略

- 軽量な運用KPI取得手段として、**Google Apps Script（GAS）とGoogle Spreadsheetを活用**
- Laravel側でユーザーの行動ログ（ログイン、ガチャ、クエストなど）を日次ログテーブルに記録
- `Laravel Scheduler`（cron）を活用し、**日次バッチ処理でGASへ集計データを送信**
- GASがGoogleスプレッドシートに記録することで、**非エンジニアでもアクセス可能な簡易ダッシュボード**として活用可能
- MVP段階ではKPI項目を絞り、将来的にログ基盤（BigQuery等）への移行も視野に入れる


### Redis（キャッシュ・ランキング処理）

本構成では MVP フェーズの迅速な開発を優先し、Redis は導入を見送っています。  
アクセス数の増加やランキング処理の重さがボトルネックになった際に、以下の処理を Redis に切り替える想定です：

- マスターデータの一時キャッシュ
- ガチャ排出結果のレスポンスキャッシュ
- リアルタイムランキングの一時保存（定期バッチ + Redisソート）


### 将来的な拡張・改善余地

MVP以降の成長フェーズでは、Redis導入・ログ分析基盤強化・マイクロサービス化など段階的な拡張を想定。

---

この構成は、**ゲーム業界で一般的に採用される「王道構成」**であり、エンジニアのチーム移動やスケールにも柔軟に対応できるバランスを重視しています。
